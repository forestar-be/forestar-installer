// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "sqlite"
    url      = env("DATABASE_URL")
}

enum InventoryCategory {
    ROBOT
    PLUGIN
    ANTENNA
    SHELTER
    WIRE
    SUPPORT
}

model RobotInventory {
    id            Int               @id @default(autoincrement())
    reference     String?
    name          String
    category      InventoryCategory @default(ROBOT)
    sellingPrice  Float?
    purchasePrice Float?
    createdAt     DateTime          @default(now())
    updatedAt     DateTime          @updatedAt

    // Relations
    purchaseOrders          PurchaseOrder[] @relation("RobotToPurchaseOrder")
    purchaseOrdersAsPlugin  PurchaseOrder[] @relation("PluginToPurchaseOrder")
    purchaseOrdersAsAntenna PurchaseOrder[] @relation("AntennaToPurchaseOrder")
    purchaseOrdersAsShelter PurchaseOrder[] @relation("ShelterToPurchaseOrder")
}

model PurchaseOrder {
    id        Int      @id @default(autoincrement())
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    // Client information
    clientFirstName                String
    clientLastName                 String
    clientAddress                  String
    clientCity                     String
    clientPhone                    String
    clientEmail                    String   @default("")
    deposit                        Float    @default(0)
    devisSignatureAccessTokenArray String[] @default([])
    emailDevisSent                 Boolean  @default(false)

    // Robot details
    robotInventoryId Int
    robotInventory   RobotInventory @relation("RobotToPurchaseOrder", fields: [robotInventoryId], references: [id])
    serialNumber     String?

    // Accessories
    pluginInventoryId  Int?
    antennaInventoryId Int?
    shelterInventoryId Int?
    plugin             RobotInventory? @relation("PluginToPurchaseOrder", fields: [pluginInventoryId], references: [id])
    antenna            RobotInventory? @relation("AntennaToPurchaseOrder", fields: [antennaInventoryId], references: [id])
    shelter            RobotInventory? @relation("ShelterToPurchaseOrder", fields: [shelterInventoryId], references: [id])
    hasWire            Boolean         @default(false)
    wireLength         Int?
    hasAntennaSupport  Boolean         @default(false)
    hasPlacement       Boolean         @default(false)

    // Installation
    installationDate  DateTime?
    needsInstaller    Boolean   @default(false)
    installationNotes String?

    // Status fields
    hasAppointment Boolean @default(false)
    isInstalled    Boolean @default(false)
    isInvoiced     Boolean @default(false)
    devis          Boolean @default(false)

    // Crisis specific fields
    validUntil        DateTime?
    bankAccountNumber String?

    // Files
    orderPdfId  String?
    invoicePath String?
    photosPaths String[] @default([])

    // Signature fields
    clientSignature    String?
    signatureTimestamp DateTime?

    eventId String? // Calendar integration
}
